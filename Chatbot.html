<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>LocalVault — AI Chatbox Example</title>
<style>
  :root{
    --bg:#0b0d12; --panel:#111522; --panel-2:#0e1320;
    --accent:#2f6dff; --accent-2:#8ec5ff;
    --text:#e8edf6; --muted:#9aa7bd; --border:rgba(255,255,255,.08);
    --shadow:0 10px 30px rgba(0,0,0,.35), 0 1px 0 rgba(255,255,255,.03) inset;
    --radius:16px;
  }
  *{box-sizing:border-box}
  body{
    margin:0; background:radial-gradient(1400px 900px at 75% -15%, rgba(46,109,255,.18) 0%, rgba(46,109,255,0) 55%) fixed no-repeat,
                          radial-gradient(1400px 900px at 20% -20%, rgba(142,197,255,.12) 0%, rgba(142,197,255,0) 50%) fixed no-repeat,
                          var(--bg);
    background-size:cover,cover,cover;
    color:var(--text);
    font:15px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial;
    padding:24px;
  }
  .wrap{max-width:900px; margin:0 auto;}
  .header{display:flex; align-items:center; justify-content:space-between; margin-bottom:14px}
  .title{font-weight:800; letter-spacing:.2px}
  .hint{color:var(--muted); font-size:12px}

  .chat{
    border:1px solid var(--border); border-radius:var(--radius);
    background:linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,.01));
    box-shadow:var(--shadow);
    display:flex; flex-direction:column; height:min(70vh,720px);
    overflow:hidden;
  }
  .msgs{flex:1; overflow:auto; padding:14px; display:flex; flex-direction:column; gap:10px;}
  .msg{max-width:85%; padding:10px 12px; border-radius:12px; border:1px solid var(--border); white-space:pre-wrap}
  .me{align-self:flex-end; background:var(--panel-2)}
  .ai{align-self:flex-start; background:#0f1422}
  .sys{align-self:center; color:var(--muted); font-size:12px; border:none; background:transparent}
  .inputbar{display:flex; gap:8px; padding:12px; background:rgba(0,0,0,.25); border-top:1px solid var(--border)}
  .input{flex:1; border:1px solid var(--border); border-radius:12px; padding:12px; background:#0c101a; color:var(--text); outline:none}
  .btn{border:1px solid var(--border); border-radius:12px; padding:12px 14px; color:var(--text);
       background:linear-gradient(180deg, var(--accent), #1f55e8); cursor:pointer}
  .btn:disabled{opacity:.6; cursor:not-allowed}
  .toolbar{display:flex; gap:8px; padding:10px 0; align-items:center}
  select{background:#0c101a; color:var(--text); border:1px solid var(--border); border-radius:10px; padding:8px}
  .small{font-size:12px; color:var(--muted)}
  a{color:var(--accent)}
</style>
</head>
<body>
  <div class="wrap">
    <div class="header">
      <div>
        <div class="title">LocalVault – AI Chatbox</div>
        <div class="hint">Ask general banking/finance questions. Your key stays server-side.</div>
      </div>
      <div class="toolbar">
        <label class="small">Model
          <select id="model">
            <option value="gpt-4o-mini" selected>gpt-4o-mini</option>
            <option value="gpt-4o">gpt-4o</option>
          </select>
        </label>
      </div>
    </div>

    <div class="chat">
      <div id="msgs" class="msgs">
        <div class="msg ai">Hi! I’m your LocalVault helper. Ask me about budgeting, subscriptions, or ISA math.</div>
      </div>
      <div class="inputbar">
        <input id="input" class="input" placeholder="Type your question… (Enter to send)" />
        <button id="send" class="btn">Send</button>
      </div>
    </div>

    <div class="small" style="margin-top:10px">
      This page calls <code>/api/chat</code> on your server. Never expose API keys in the browser.
      See inline server example below.
    </div>
  </div>

<script>
(() => {
  // CHANGE THIS to your server route/proxy:
  const API_ENDPOINT = '/api/chat';

  const $ = sel => document.querySelector(sel);
  const msgsEl = $('#msgs');
  const inputEl = $('#input');
  const sendBtn = $('#send');
  const modelSel = $('#model');

  /** Append a message bubble */
  function addMsg(role, text){
    const el = document.createElement('div');
    el.className = 'msg ' + (role==='user'?'me': role==='assistant'?'ai':'sys');
    el.textContent = text;
    msgsEl.appendChild(el);
    msgsEl.scrollTop = msgsEl.scrollHeight;
    return el;
  }

  /** Send */
  async function send(){
    const text = inputEl.value.trim();
    if(!text) return;
    inputEl.value = '';
    addMsg('user', text);
    const thinking = addMsg('assistant', '…');

    sendBtn.disabled = true; inputEl.disabled = true;

    try{
      const res = await fetch(API_ENDPOINT, {
        method: 'POST',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify({
          model: modelSel.value,
          messages: [
            {role:'system', content:'You are LocalVault’s helpful finance assistant. Be concise and practical.'},
            ...collectTranscript()
          ]
        })
      });
      if(!res.ok){
        const errText = await res.text();
        thinking.textContent = `Error: ${res.status} ${errText}`;
      }else{
        const data = await res.json();
        const reply = data?.choices?.[0]?.message?.content ?? '(no reply)';
        thinking.textContent = reply;
      }
    }catch(err){
      thinking.textContent = 'Network error: ' + err.message;
    }finally{
      sendBtn.disabled = false; inputEl.disabled = false; inputEl.focus();
    }
  }

  /** Build short transcript from DOM to keep example simple */
  function collectTranscript(){
    const bubbles = [...msgsEl.querySelectorAll('.msg')];
    const msgs = [];
    for(const b of bubbles){
      if(b.classList.contains('me')) msgs.push({role:'user', content:b.textContent});
      else if(b.classList.contains('ai')) msgs.push({role:'assistant', content:b.textContent});
    }
    return msgs.slice(-10); // last 10 exchanges
  }

  // Events
  sendBtn.addEventListener('click', send);
  inputEl.addEventListener('keydown', e => {
    if(e.key==='Enter' && !e.shiftKey){ e.preventDefault(); send(); }
  });
})();
</script>

<!--
======== Minimal Node.js proxy (server) ========
Save as server.js and run:  npm i express node-fetch  (or undici)
Then:  node server.js
Set OPENAI_API_KEY in your environment.

import express from 'express';
import fetch from 'node-fetch'; // or use global fetch in Node 18+
const app = express();
app.use(express.json());

app.post('/api/chat', async (req, res) => {
  const { model = 'gpt-4o-mini', messages = [] } = req.body || {};
  try{
    const r = await fetch('https://api.openai.com/v1/chat/completions', {
      method:'POST',
      headers:{
        'Content-Type':'application/json',
        'Authorization':`Bearer ${process.env.OPENAI_API_KEY}`
      },
      body: JSON.stringify({ model, messages })
    });
    res.status(r.status).send(await r.text());
  }catch(err){
    res.status(500).json({error: err.message});
  }
});

app.listen(3000, () => console.log('Proxy on http://localhost:3000'));
================================================
-->
</body>
</html>
